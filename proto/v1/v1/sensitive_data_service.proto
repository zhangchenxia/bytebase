syntax = "proto3";

package bytebase.v1;

option go_package = "generated-go/v1";

import "google/api/annotations.proto";
import "google/protobuf/empty.proto";
import "v1/common.proto";

// SensitiveDataService provides methods for managing sensitive data rules and fields.
service SensitiveDataService {
  // ListSensitiveDataRules returns a list of sensitive data rules.
  rpc ListSensitiveDataRules(ListSensitiveDataRulesRequest) returns (ListSensitiveDataRulesResponse) {
    option (google.api.http) = {
      get: "/api/v1/sensitive-data-rules"
    };
  }

  // GetSensitiveDataRule returns a specific sensitive data rule.
  rpc GetSensitiveDataRule(GetSensitiveDataRuleRequest) returns (SensitiveDataRule) {
    option (google.api.http) = {
      get: "/api/v1/{name=sensitive-data-rules/*}"
    };
  }

  // CreateSensitiveDataRule creates a new sensitive data rule.
  rpc CreateSensitiveDataRule(CreateSensitiveDataRuleRequest) returns (SensitiveDataRule) {
    option (google.api.http) = {
      post: "/api/v1/sensitive-data-rules"
      body: "rule"
    };
  }

  // UpdateSensitiveDataRule updates an existing sensitive data rule.
  rpc UpdateSensitiveDataRule(UpdateSensitiveDataRuleRequest) returns (SensitiveDataRule) {
    option (google.api.http) = {
      patch: "/api/v1/{rule.name=sensitive-data-rules/*}"
      body: "rule"
    };
  }

  // DeleteSensitiveDataRule deletes a sensitive data rule.
  rpc DeleteSensitiveDataRule(DeleteSensitiveDataRuleRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      delete: "/api/v1/{name=sensitive-data-rules/*}"
    };
  }

  // ListSensitiveDataFields returns a list of sensitive data fields.
  rpc ListSensitiveDataFields(ListSensitiveDataFieldsRequest) returns (ListSensitiveDataFieldsResponse) {
    option (google.api.http) = {
      get: "/api/v1/sensitive-data-fields"
    };
  }

  // GetSensitiveDataField returns a specific sensitive data field.
  rpc GetSensitiveDataField(GetSensitiveDataFieldRequest) returns (SensitiveDataField) {
    option (google.api.http) = {
      get: "/api/v1/{name=sensitive-data-fields/*}"
    };
  }

  // UpdateSensitiveDataField updates an existing sensitive data field.
  rpc UpdateSensitiveDataField(UpdateSensitiveDataFieldRequest) returns (SensitiveDataField) {
    option (google.api.http) = {
      patch: "/api/v1/{field.name=sensitive-data-fields/*}"
      body: "field"
    };
  }
}

// SensitiveDataLevel represents the sensitivity level of data.
enum SensitiveDataLevel {
  SENSITIVE_DATA_LEVEL_UNSPECIFIED = 0;
  // Low sensitivity data, no approval required.
  SENSITIVE_DATA_LEVEL_LOW = 1;
  // Medium sensitivity data, 1-level approval required.
  SENSITIVE_DATA_LEVEL_MEDIUM = 2;
  // High sensitivity data, 2-level approval required.
  SENSITIVE_DATA_LEVEL_HIGH = 3;
}

// SensitiveDataRule represents a rule for identifying sensitive data.
message SensitiveDataRule {
  // The name of the sensitive data rule. Format: sensitive-data-rules/{rule}.
  string name = 1;
  // The title of the sensitive data rule.
  string title = 2;
  // The description of the sensitive data rule.
  string description = 3;
  // The sensitivity level of the data matched by this rule.
  SensitiveDataLevel level = 4;
  // The list of field names to match (exact match).
  repeated string field_names = 5;
  // The list of data types to match (exact match).
  repeated string data_types = 6;
  // The regular expression to match against field values.
  string regex_pattern = 7;
  // The resource name of the project this rule belongs to. Format: projects/{project}.
  string project = 8;
  // The resource name of the database this rule belongs to. Format: instances/{instance}/databases/{database}.
  string database = 9;
  // The name of the table this rule belongs to (empty for all tables).
  string table_name = 10;
  // Whether this rule is enabled.
  bool enabled = 11;
  // Output only. The time when this rule was created.
  int64 create_time = 12;
  // Output only. The time when this rule was last updated.
  int64 update_time = 13;
}

// SensitiveDataField represents a field identified as sensitive data.
message SensitiveDataField {
  // The name of the sensitive data field. Format: sensitive-data-fields/{field}.
  string name = 1;
  // The resource name of the project this field belongs to. Format: projects/{project}.
  string project = 2;
  // The resource name of the database this field belongs to. Format: instances/{instance}/databases/{database}.
  string database = 3;
  // The name of the table this field belongs to.
  string table_name = 4;
  // The name of the field.
  string field_name = 5;
  // The data type of the field.
  string data_type = 6;
  // The sensitivity level of the field.
  SensitiveDataLevel level = 7;
  // The list of rule names that matched this field. Format: sensitive-data-rules/{rule}.
  repeated string matched_rules = 8;
  // Whether this field is enabled for sensitivity checking.
  bool enabled = 9;
  // Output only. The time when this field was created.
  int64 create_time = 10;
  // Output only. The time when this field was last updated.
  int64 update_time = 11;
}

// ListSensitiveDataRulesRequest is the request message for ListSensitiveDataRules.
message ListSensitiveDataRulesRequest {
  // The parent resource name. Format: projects/{project} or instances/{instance}/databases/{database}.
  string parent = 1;
  // The maximum number of results to return per page.
  int32 page_size = 2;
  // The page token received from a previous ListSensitiveDataRules call.
  string page_token = 3;
}

// ListSensitiveDataRulesResponse is the response message for ListSensitiveDataRules.
message ListSensitiveDataRulesResponse {
  // The list of sensitive data rules.
  repeated SensitiveDataRule rules = 1;
  // A token to retrieve next page of results.
  string next_page_token = 2;
}

// GetSensitiveDataRuleRequest is the request message for GetSensitiveDataRule.
message GetSensitiveDataRuleRequest {
  // The name of the sensitive data rule. Format: sensitive-data-rules/{rule}.
  string name = 1;
}

// CreateSensitiveDataRuleRequest is the request message for CreateSensitiveDataRule.
message CreateSensitiveDataRuleRequest {
  // The parent resource name. Format: projects/{project} or instances/{instance}/databases/{database}.
  string parent = 1;
  // The sensitive data rule to create.
  SensitiveDataRule rule = 2;
}

// UpdateSensitiveDataRuleRequest is the request message for UpdateSensitiveDataRule.
message UpdateSensitiveDataRuleRequest {
  // The sensitive data rule to update.
  SensitiveDataRule rule = 1;
  // The update mask applies to the resource.
  google.protobuf.FieldMask update_mask = 2;
}

// DeleteSensitiveDataRuleRequest is the request message for DeleteSensitiveDataRule.
message DeleteSensitiveDataRuleRequest {
  // The name of the sensitive data rule. Format: sensitive-data-rules/{rule}.
  string name = 1;
}

// ListSensitiveDataFieldsRequest is the request message for ListSensitiveDataFields.
message ListSensitiveDataFieldsRequest {
  // The parent resource name. Format: projects/{project} or instances/{instance}/databases/{database}.
  string parent = 1;
  // The maximum number of results to return per page.
  int32 page_size = 2;
  // The page token received from a previous ListSensitiveDataFields call.
  string page_token = 3;
}

// ListSensitiveDataFieldsResponse is the response message for ListSensitiveDataFields.
message ListSensitiveDataFieldsResponse {
  // The list of sensitive data fields.
  repeated SensitiveDataField fields = 1;
  // A token to retrieve next page of results.
  string next_page_token = 2;
}

// GetSensitiveDataFieldRequest is the request message for GetSensitiveDataField.
message GetSensitiveDataFieldRequest {
  // The name of the sensitive data field. Format: sensitive-data-fields/{field}.
  string name = 1;
}

// UpdateSensitiveDataFieldRequest is the request message for UpdateSensitiveDataField.
message UpdateSensitiveDataFieldRequest {
  // The sensitive data field to update.
  SensitiveDataField field = 1;
  // The update mask applies to the resource.
  google.protobuf.FieldMask update_mask = 2;
}
